# CVE-2022-0185

This is a custom implementation of an exploit for [CVE-2022-0185](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-0185). This is **not** an original exploit, it's based on the following public ones:

- https://github.com/Crusaders-of-Rust/CVE-2022-0185
- https://www.openwall.com/lists/oss-security/2022/01/25/14

The goals I had in mind when doing this are the following:

1. Main goal: learn common techniques used for exploiting vulnerabilities in the Linux kernel
2. Create some code that could be later reused for other kernel exploits
3. Provide an environment where the exploit could be reliably executed, with minimal configuration by the user. Preferably, this should be an Ubuntu VM, or any other widely used distro (no vanilla kernel). The sad reality is that, after spending some time creating this environment, the resulting qcow2 image was over 40GB, so I figured it wasn't a great idea after all
4. Provide GDB scripts that could be used to debug the exploit and see the details in real time, while the exploit is being executed. Again, ideally this should work with minimal user configuration. 
   In the end, I created some simple GDB scripts that helped me debug and better understand the vulnerability and why the exploit worked or did not work. The initial idea was to provide better GDB scripts that would explain the different exploitation steps in real time, but this remains to be done - maybe if I find some time in the near future I'll give it a try

## PoC

I tested the exploit in a VM running Ubuntu 21.04 Hirsute with kernel 5.11.0-16-generic and all mitigations in place.

This was supposed to be a testbed to be shared, but for the reasons mentioned above this seems unpractical. Instead you can see a GIF of the exploit in action:
![cve-2022-0185 PoC](./img/exploit.gif)

## Debugging and Scripts

To provided scripts are very rudimentary right now, but they have been still useful:

- `reset-modprobe.gdb` simply restores the variable `modprobe_path` to its original value. This is useful if we want to execute the exploit multiple times to make tests
- `script.gdb` introduces some breakpoints and prints some useful information during the exploit. It can be used to better understand the exploit as it goes, but it significantly reduces the speed of execution

